<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BARandomGenerator.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">CHIAScalabilityEvaluator</a> &gt; <a href="index.source.html" class="el_package">it.polimi.chia.scalability.randomGenerators</a> &gt; <span class="el_source">BARandomGenerator.java</span></div><h1>BARandomGenerator.java</h1><pre class="source lang-java linenums">package it.polimi.chia.scalability.randomGenerators;

import it.polimi.action.CHIAAction;
import it.polimi.automata.BA;
import it.polimi.automata.state.State;
import it.polimi.automata.state.StateFactory;
import it.polimi.automata.transition.ClaimTransitionFactory;

import java.util.ArrayList;
import java.util.Collections;
import java.util.HashSet;
import java.util.List;
import java.util.Random;
import java.util.Set;

import rwth.i2.ltl2ba4j.model.IGraphProposition;

import com.google.common.base.Preconditions;

/**
 * is used to generate a random BA. a random Buchi automaton is generated over
 * an alphabet made by two propositions a, b. For each proposition of the
 * alphabet a random directed graph with a single initial state and $k$
 * transition is generated. The ``hardness&quot; of the problem is changed by
 * controlling the density of the transitions, i.e., the ratio between the
 * number of transitions per input letter and the number of the states
 * ($r=|\Delta|/|Q|$), and the density of \emph{accepting} states, i.e., the
 * ratio between the accepting states and the total number of the states
 * ($f=|F|/|Q|$). The transition density represents the expected number of
 * transition that exits a state. The generation procedure also imposes that the
 * initial state has an outgoing transition for each proposition of the
 * alphabet, which allows to not consider trivial cases. The number of accepting
 * states, which are selected randomly between the set of the states of the
 * BA/IBA, is a linear function of the number of the states of the system.
 * 
 * @author Claudio Menghi
 *
 */
public class BARandomGenerator extends CHIAAction&lt;BA&gt;{

	/**
	 * contains the number of the states to be added to the BA
	 */
	private final int nStates;

	/**
	 * is the expected density of transitions for the BA
	 */
	private final double transitionDensity;

	/**
	 * is the expected density of accepting states for the ba
	 */
	private final double acceptanceDensity;

	/**
	 * is the random element used to choose the states to be connected in the
	 * automaton
	 */
	private final Random randSingleton;

	/**
	 * is the factory which is used to create the states of the automaton
	 */
	private final StateFactory stateFactory;

	/**
	 * is the set of propositions to be used in labeling the transitions of the
	 * automaton
	 */
	private final Set&lt;IGraphProposition&gt; propositions;

	/**
	 * contains the BA to be returned
	 */
	private BA ba;

	/**
	 * is the transition factory to be used in the creation of the transitions
	 * of the automaton
	 */
	private ClaimTransitionFactory transitionFactory;
	
	private static final String ACTION_NAME=&quot;BA random generation&quot;;

	/**
	 * Creates a random generator for a Buchi automaton
	 * 
	 * @param propositions
	 *            is the set of propositions to be added to the BA
	 * @param stateFactory
	 *            is the factory which is used to create the states of the BA
	 * @param transitionDensity
	 *            is the expected transition density for the BA
	 * @param acceptanceDensity
	 *            is the expected density of accepting states
	 * @param nStates
	 *            is the expected number of states of the ba
	 * @param transitionsStateChooser
	 *            is the random element used to choose the states to be
	 *            connected by the transitions
	 * @throws NullPointerException
	 *             if the set of propositions is null, if the state factory is
	 *             null
	 * @throws IllegalArgumentException
	 *             if the transition density is not grater then or equal to zero
	 *             OR &lt;br&gt;
	 *             if the accepting density is not grater then or equal to zero
	 *             OR &lt;br&gt;
	 *             if the number of states is not grater then or equal to zero
	 */
	public BARandomGenerator(Set&lt;IGraphProposition&gt; propositions,
			StateFactory stateFactory, double transitionDensity,
			double acceptanceDensity, int nStates,
			Random transitionsStateChooser) {
<span class="fc" id="L116">		super(ACTION_NAME);</span>
<span class="fc" id="L117">		Preconditions.checkNotNull(propositions,</span>
				&quot;The set of propositions cannot be null&quot;);
<span class="fc" id="L119">		Preconditions.checkNotNull(stateFactory,</span>
				&quot;The state factory cannot be null&quot;);

<span class="pc bpc" id="L122" title="1 of 2 branches missed.">		Preconditions.checkArgument(transitionDensity &gt;= 0,</span>
				&quot;The transition density must be greater or equal to zero&quot;);
<span class="pc bpc" id="L124" title="1 of 2 branches missed.">		Preconditions.checkArgument(acceptanceDensity &gt;= 0,</span>
				&quot;The acceptance density must be greater or equal to zero&quot;);
<span class="pc bpc" id="L126" title="1 of 2 branches missed.">		Preconditions.checkArgument(nStates &gt;= 0,</span>
				&quot;The number of states must be greater or equal to zero&quot;);
<span class="fc" id="L128">		this.nStates = nStates;</span>
<span class="fc" id="L129">		this.transitionDensity = transitionDensity;</span>
<span class="fc" id="L130">		this.acceptanceDensity = acceptanceDensity;</span>
<span class="fc" id="L131">		this.randSingleton = transitionsStateChooser;</span>
<span class="fc" id="L132">		this.stateFactory = stateFactory;</span>
<span class="fc" id="L133">		this.propositions = propositions;</span>
<span class="fc" id="L134">		this.transitionFactory = new ClaimTransitionFactory();</span>
<span class="fc" id="L135">	}</span>

	/**
	 * Generates a random Buchi Automaton in relation with the parameters passed
	 * to the {@link BARandomGenerator} constructor
	 * 
	 * @return the randomly generated BA
	 */
	public BA perform() {

<span class="fc" id="L145">		this.ba = new BA(transitionFactory);</span>

		// adds the propositions to the ba to be returned
<span class="fc" id="L148">		this.addPropositions();</span>
		// adds the randomly generated states to the BA
<span class="fc" id="L150">		this.createStates();</span>
		// adds the accepting states to the BA
<span class="fc" id="L152">		this.addAcceptingStates();</span>
		// creates the transitions between the states of the BA
<span class="fc" id="L154">		this.createTransitions();</span>
		// creates a new state which is the initial state for the BA
<span class="fc" id="L156">		State initState = this.addInitialState();</span>

		// creates the transitions which exit the initial state
<span class="fc" id="L159">		this.createTransitionsInitialState(initState);</span>
<span class="fc" id="L160">		return ba;</span>
	}

	/**
	 * adds the propositions to the BA to be returned
	 */
	private void addPropositions() {
<span class="fc bfc" id="L167" title="All 2 branches covered.">		for (IGraphProposition proposition : propositions) {</span>
<span class="fc" id="L168">			ba.addProposition(proposition);</span>
<span class="fc" id="L169">		}</span>
<span class="fc" id="L170">	}</span>

	/**
	 * @param initialState
	 *            creates the transitions which exit the initial state
	 * @throws NullPointerException
	 *             if the initial state is null
	 * @throws IllegalArgumentException
	 *             if the initials State is not contained in the BA
	 */
	private void createTransitionsInitialState(State initialState) {

<span class="fc" id="L182">		Preconditions.checkNotNull(initialState,</span>
				&quot;The initial state cannot be null&quot;);
<span class="fc" id="L184">		Preconditions</span>
<span class="fc" id="L185">				.checkArgument(</span>
<span class="fc" id="L186">						this.ba.getInitialStates().contains(initialState),</span>
						&quot;The initial state must be contained into the set of initial states of the automaton&quot;);

<span class="fc" id="L189">		List&lt;State&gt; baStates = new ArrayList&lt;State&gt;(this.ba.getStates());</span>
<span class="fc" id="L190">		baStates.removeAll(ba.getInitialStates());</span>

<span class="fc" id="L192">		int j = 0;</span>
<span class="fc bfc" id="L193" title="All 2 branches covered.">		for (IGraphProposition proposition : propositions) {</span>
<span class="fc" id="L194">			Set&lt;IGraphProposition&gt; transitionPropositions = new HashSet&lt;IGraphProposition&gt;();</span>
<span class="fc" id="L195">			transitionPropositions.add(proposition);</span>
<span class="fc" id="L196">			ba.addTransition(initialState, baStates.get(j),</span>
<span class="fc" id="L197">					transitionFactory.create(transitionPropositions));</span>
<span class="fc" id="L198">			j++;</span>
<span class="fc" id="L199">		}</span>
<span class="fc" id="L200">	}</span>

	/**
	 * creates the transitions between the states of the BA
	 */
	private void createTransitions() {

<span class="fc" id="L207">		int numTransition = (int) Math.round((nStates - 1) * transitionDensity);</span>
<span class="fc" id="L208">		List&lt;State&gt; states = new ArrayList&lt;State&gt;(ba.getStates());</span>
<span class="fc bfc" id="L209" title="All 2 branches covered.">		for (IGraphProposition proposition : propositions) {</span>
<span class="fc" id="L210">			Set&lt;IGraphProposition&gt; transitionPropositions = new HashSet&lt;IGraphProposition&gt;();</span>
<span class="fc" id="L211">			transitionPropositions.add(proposition);</span>
<span class="fc bfc" id="L212" title="All 2 branches covered.">			for (int i = 0; i &lt; numTransition; ++i) {</span>
<span class="fc" id="L213">				ba.addTransition(</span>
<span class="fc" id="L214">						states.get(randSingleton.nextInt(nStates - 1)),</span>
<span class="fc" id="L215">						states.get(randSingleton.nextInt(nStates - 1)),</span>
<span class="fc" id="L216">						transitionFactory.create(transitionPropositions));</span>
			}

<span class="fc" id="L219">		}</span>
<span class="fc" id="L220">	}</span>

	/**
	 * adds the randomly generated states to the BA
	 */
	private void createStates() {
<span class="fc bfc" id="L226" title="All 2 branches covered.">		for (int i = 0; i &lt; (nStates - 1); i++) {</span>
<span class="fc" id="L227">			ba.addState(this.stateFactory.create());</span>
		}
<span class="fc" id="L229">	}</span>

	/**
	 * adds the accepting states to the BA
	 */
	private void addAcceptingStates() {
<span class="fc" id="L235">		int i = 0;</span>
<span class="fc" id="L236">		int numAcceptingStates = (int) Math.round(nStates * acceptanceDensity);</span>

<span class="fc" id="L238">		ArrayList&lt;State&gt; baStates = new ArrayList&lt;State&gt;(ba.getStates());</span>
<span class="fc" id="L239">		Collections.shuffle(baStates);</span>
<span class="fc bfc" id="L240" title="All 2 branches covered.">		for (State s : baStates) {</span>
<span class="fc bfc" id="L241" title="All 2 branches covered.">			if (i &lt; numAcceptingStates) {</span>
<span class="fc" id="L242">				ba.addAcceptState(s);</span>
<span class="fc" id="L243">				i++;</span>
			}
<span class="fc" id="L245">		}</span>
<span class="fc" id="L246">	}</span>

	/**
	 * creates a new state which is the initial state for the BA
	 * 
	 * @return the initial state of the BA
	 */
	private State addInitialState() {
<span class="fc" id="L254">		State initState = this.stateFactory.create();</span>
<span class="fc" id="L255">		this.ba.addInitialState(initState);</span>
<span class="fc" id="L256">		return initState;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span></div></body></html>