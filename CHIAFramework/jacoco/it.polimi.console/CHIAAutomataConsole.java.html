<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CHIAAutomataConsole.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">CHIAFramework</a> &gt; <a href="index.source.html" class="el_package">it.polimi.console</a> &gt; <span class="el_source">CHIAAutomataConsole.java</span></div><h1>CHIAAutomataConsole.java</h1><pre class="source lang-java linenums">package it.polimi.console;

import it.polimi.action.CHIAException;
import it.polimi.automata.BA;
import it.polimi.automata.IBA;
import it.polimi.automata.io.in.ClaimReader;
import it.polimi.automata.io.in.ModelReader;
import it.polimi.automata.io.out.ClaimToStringTrasformer;
import it.polimi.automata.io.out.ElementToStringTransformer;
import it.polimi.automata.io.out.IBAToElementTrasformer;
import it.polimi.checker.Checker;
import it.polimi.checker.SatisfactionValue;
import it.polimi.checker.intersection.acceptingpolicies.AcceptingPolicy;
import it.polimi.checker.intersection.acceptingpolicies.AcceptingPolicy.AcceptingType;
import it.polimi.constraintcomputation.ConstraintGenerator;
import it.polimi.constraints.Constraint;
import it.polimi.constraints.io.out.constraint.ConstraintToStringTrasformer;
import it.polimi.constraints.io.out.constraint.ConstraintWriter;
import it.polimi.model.ltltoba.LTLtoBATransformer;
import it.polimi.statemachine.states.CHIAAutomataState;

import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.PrintStream;
import java.lang.management.ManagementFactory;
import java.lang.management.ThreadMXBean;
import java.nio.file.Files;
import java.nio.file.LinkOption;
import java.nio.file.Paths;
import java.util.concurrent.TimeUnit;

import javax.xml.parsers.ParserConfigurationException;

import org.apache.commons.lang3.exception.ExceptionUtils;
import org.apache.log4j.Logger;
import org.xml.sax.SAXException;

import com.google.common.base.Preconditions;

/**
 * Is the Console associated with the automata mode. It specifies the set of
 * action that can be performed when the automata mode is selected
 * 
 * @author Claudio Menghi
 *
 */
public class CHIAAutomataConsole {

<span class="fc" id="L49">	private static final Logger LOGGER = Logger</span>
<span class="fc" id="L50">			.getLogger(CHIAAutomataConsole.class);</span>

	/**
	 * contains the model of the system to be considered. Null if no model is
	 * loaded
	 */
	protected IBA model;

	/**
	 * is the stream used to write messages on the console
	 */
	private final PrintStream out;

	/**
	 * contains the claim to be considered. Null if no claim is loaded
	 */
	protected BA claim;

	/**
	 * contains the model checker to be used in the model checking activity
	 */
	protected Checker checker;

	/**
	 * is the state of the application. The state changes in response to user
	 * inputs
	 */
	private CHIAAutomataState chiaState;

	/**
	 * contains the constraint associated with the specified model and claim if
	 * the model possibly satisfy the claim
	 */
	protected Constraint constraint;

	/**
	 * contains the accepting policy which specifies how the accepting states of
	 * the intersection automata are computed
	 */
	private AcceptingType policy;

	/**
	 * contains the engine used to compute the constraint
	 */
	private ConstraintGenerator cg;

	/**
	 * creates the {@link CHIAAutomataConsole}
	 * 
	 * @param out
	 *            is the stream used to write messages
	 * @throws NullPointerException
	 *             if the out is null
	 */
<span class="fc" id="L104">	public CHIAAutomataConsole(PrintStream out) {</span>
<span class="fc" id="L105">		Preconditions.checkNotNull(out, &quot;The output stream cannot be null&quot;);</span>
<span class="fc" id="L106">		policy = AcceptingType.BA;</span>
<span class="fc" id="L107">		chiaState = CHIAAutomataState.INIT;</span>
<span class="fc" id="L108">		this.out = out;</span>
<span class="fc" id="L109">	}</span>

	/**
	 * loads the model from the specified path
	 * 
	 * @param modelFilePath
	 *            is the path of the file that contains the model
	 * 
	 * @throws NullPointerException
	 *             if the path of the file is null
	 * @throws IllegalArgumentException
	 *             if the file does not exist
	 */
	public void loadModel(String modelFilePath) {

<span class="fc" id="L124">		com.google.common.base.Preconditions.checkNotNull(modelFilePath,</span>
				&quot;The path of the model cannot be null&quot;);
<span class="fc" id="L126">		com.google.common.base.Preconditions.checkArgument(Files.exists(</span>
<span class="fc" id="L127">				Paths.get(modelFilePath), LinkOption.NOFOLLOW_LINKS),</span>
				&quot;The path of the model cannot be null&quot;);

		try {
<span class="fc" id="L131">			this.chiaState = chiaState.perform(ModelReader.class);</span>

<span class="fc" id="L133">			ModelReader action = new ModelReader(modelFilePath);</span>
<span class="fc" id="L134">			this.model = action.perform();</span>
<span class="fc" id="L135">			out.println(&quot;Model readed&quot;);</span>
<span class="fc" id="L136">			out.println(&quot;N° states: &quot; + this.model.getStates().size());</span>
<span class="fc" id="L137">			out.println(&quot;N° transitions:&quot; + this.model.getTransitions().size());</span>

<span class="nc" id="L139">		} catch (FileNotFoundException fileNotFound) {</span>
<span class="nc" id="L140">			LOGGER.info(fileNotFound.toString());</span>
<span class="nc" id="L141">			out.println(fileNotFound.getMessage());</span>
<span class="nc" id="L142">		} catch (CHIAException e) {</span>
<span class="nc" id="L143">			LOGGER.info(ExceptionUtils.getStackTrace(e));</span>
<span class="nc" id="L144">			out.println(e.getMessage());</span>
<span class="nc" id="L145">		} catch (SAXException e) {</span>
<span class="nc" id="L146">			LOGGER.info(ExceptionUtils.getStackTrace(e));</span>
<span class="nc" id="L147">			out.println(e.getMessage());</span>
<span class="nc" id="L148">		} catch (IOException e) {</span>
<span class="nc" id="L149">			LOGGER.info(ExceptionUtils.getStackTrace(e));</span>
<span class="nc" id="L150">			out.println(e.getMessage());</span>
<span class="nc" id="L151">		} catch (ParserConfigurationException e) {</span>
<span class="nc" id="L152">			LOGGER.info(ExceptionUtils.getStackTrace(e));</span>
<span class="nc" id="L153">			out.println(e.getMessage());</span>
<span class="pc" id="L154">		}</span>
<span class="fc" id="L155">	}</span>

	/**
	 * loads the property in form of automaton from the specified file path
	 * 
	 * @param claimFilePath
	 *            the path of the file from which the property must be loaded
	 * @throws FileNotFoundException
	 *             generated if the file is not found
	 * @throws ParserConfigurationException
	 *             generated if a parsing error occurs
	 * @throws SAXException
	 *             whenever a SAX exception occurs
	 * @throws IOException
	 *             in the case of IO exceptions
	 */
	public void loadProperty(String claimFilePath)
			throws FileNotFoundException, ParserConfigurationException,
			SAXException, IOException {
		try {
<span class="fc" id="L175">			this.chiaState = chiaState.perform(ClaimReader.class);</span>
<span class="fc" id="L176">			ClaimReader action = new ClaimReader(claimFilePath);</span>
<span class="fc" id="L177">			this.claim = action.perform();</span>
<span class="fc" id="L178">			out.println(&quot;Property loaded&quot;);</span>
<span class="fc" id="L179">			out.println(&quot;N° states: &quot; + this.claim.getStates().size());</span>
<span class="fc" id="L180">			out.println(&quot;N° transitions:&quot; + this.claim.getTransitions().size());</span>

<span class="nc" id="L182">		} catch (CHIAException e) {</span>
<span class="nc" id="L183">			LOGGER.info(e.toString());</span>
<span class="fc" id="L184">		}</span>
<span class="fc" id="L185">	}</span>

	/**
	 * loads the automaton that corresponds to the property of interest from the
	 * specified LTL formula
	 * 
	 * @param ltlProperty
	 *            is the LTL property to be converted into the corresponding
	 *            automaton
	 */
	public void loadLTLProperty(String ltlProperty) {
<span class="fc bfc" id="L196" title="All 2 branches covered.">		if (ltlProperty != null) {</span>
			try {
<span class="fc" id="L198">				this.chiaState = chiaState.perform(LTLtoBATransformer.class);</span>
<span class="fc" id="L199">				LTLtoBATransformer action = new LTLtoBATransformer(&quot;!(&quot;</span>
						+ ltlProperty + &quot;)&quot;);
<span class="fc" id="L201">				this.claim = action.perform();</span>
<span class="fc" id="L202">				out.println(&quot;Property loaded&quot;);</span>
<span class="fc" id="L203">				out.println(&quot;N° states: &quot; + this.claim.getStates().size());</span>
<span class="fc" id="L204">				out.println(&quot;N° transitions:&quot; + this.claim.getTransitions().size());</span>

<span class="nc" id="L206">			} catch (UnsatisfiedLinkError e) {</span>
<span class="nc" id="L207">				LOGGER.info(e.getMessage());</span>
<span class="nc" id="L208">				LOGGER.info(e.toString());</span>
<span class="nc" id="L209">				LOGGER.info(&quot;The convertion of an LTL formula into the corresponding automaton is based on the LTL2BA4J library.&quot;);</span>
<span class="nc" id="L210">				LOGGER.info(&quot;The LTL2BA4J library uses the ltl2ba tool. ltl2ba is written in ANSI C&quot;);</span>
<span class="nc" id="L211">				LOGGER.info(&quot;The library must be available at the specified path&quot;);</span>
<span class="nc" id="L212">				LOGGER.info(&quot;For additional informations see http://www.sable.mcgill.ca/~ebodde/rv/ltl2ba4j/&quot;);</span>
<span class="nc" id="L213">				LOGGER.info(&quot;If you do not want to install the library you can load the claim directly from a BA using the command lp&quot;);</span>

<span class="nc" id="L215">			} catch (Exception e) {</span>
<span class="nc" id="L216">				LOGGER.info(e.getMessage());</span>
<span class="nc" id="L217">				LOGGER.info(e.toString());</span>
<span class="nc" id="L218">				LOGGER.info(&quot;The convertion of an LTL formula into the corresponding automaton is based on the LTL2BA4J library.&quot;);</span>
<span class="nc" id="L219">				LOGGER.info(&quot;The LTL2BA4J library uses the ltl2ba tool. ltl2ba is written in ANSI C&quot;);</span>
<span class="nc" id="L220">				LOGGER.info(&quot;If the compiled version of the library is not compatible with your operating system &quot;</span>
						+ &quot;you must download the source of ltl2ba from http://www.sable.mcgill.ca/~ebodde/rv/ltl2ba4j/ltl2ba4j.tgz&quot;
						+ &quot; and recompile the source of ltl2ba&quot;);
<span class="nc" id="L223">				LOGGER.info(&quot;For additional informations see http://www.sable.mcgill.ca/~ebodde/rv/ltl2ba4j/&quot;);</span>
<span class="nc" id="L224">				LOGGER.info(&quot;If you do not want to install the library you can load the claim directly from a BA using the command lp&quot;);</span>
<span class="nc" id="L225">			} catch (NoClassDefFoundError e) {</span>
<span class="nc" id="L226">				LOGGER.info(e.toString());</span>
<span class="nc" id="L227">				LOGGER.info(&quot;The convertion of an LTL formula into the corresponding automaton is based on the LTL2BA4J library.&quot;);</span>
<span class="nc" id="L228">				LOGGER.info(&quot;The LTL2BA4J library uses the ltl2ba tool. ltl2ba is written in ANSI C&quot;);</span>
<span class="nc" id="L229">				LOGGER.info(&quot;If the compiled version of the library is not compatible with your operating system &quot;</span>
						+ &quot;you must download the source of ltl2ba from http://www.sable.mcgill.ca/~ebodde/rv/ltl2ba4j/ltl2ba4j.tgz&quot;
						+ &quot; and recompile the source of ltl2ba&quot;);
<span class="nc" id="L232">				LOGGER.info(&quot;For additional informations see http://www.sable.mcgill.ca/~ebodde/rv/ltl2ba4j/&quot;);</span>
<span class="nc" id="L233">				LOGGER.info(&quot;If you do not want to install the library you can load the claim directly from a BA using the command lp&quot;);</span>
<span class="pc" id="L234">			}</span>
		}
<span class="fc" id="L236">	}</span>

	/**
	 * displays the model of the system
	 * 
	 * @throws Exception
	 *             if an exception occurs
	 */
	public void dispModel() throws Exception {

<span class="fc" id="L246">		Preconditions</span>
<span class="fc" id="L247">				.checkNotNull(model,</span>
						&quot;The model of the system must be loaded before being displayed&quot;);

<span class="fc" id="L250">		out.println(new ElementToStringTransformer()</span>
<span class="fc" id="L251">				.transform(new IBAToElementTrasformer().transform(this.model)));</span>
<span class="fc" id="L252">	}</span>

	public void dispClaim() throws ParserConfigurationException, Exception {
		try {

<span class="fc" id="L257">			this.chiaState = chiaState.perform(ClaimToStringTrasformer.class);</span>
<span class="fc" id="L258">			ClaimToStringTrasformer action = new ClaimToStringTrasformer(</span>
					this.claim);
<span class="fc" id="L260">			out.println(action.perform());</span>
<span class="nc" id="L261">		} catch (CHIAException e) {</span>
<span class="nc" id="L262">			LOGGER.info(e.toString());</span>
<span class="fc" id="L263">		}</span>
<span class="fc" id="L264">	}</span>

	public void check() {
		try {
<span class="fc" id="L268">			this.chiaState = chiaState.perform(Checker.class);</span>
<span class="fc" id="L269">			ThreadMXBean thradBean = ManagementFactory.getThreadMXBean();</span>
<span class="fc" id="L270">			long startTime = thradBean.getCurrentThreadCpuTime();</span>
<span class="fc" id="L271">			checker = new Checker(model, claim,</span>
<span class="fc" id="L272">					AcceptingPolicy.getAcceptingPolicy(policy, model, claim));</span>
<span class="fc" id="L273">			SatisfactionValue result = checker.perform();</span>
<span class="fc" id="L274">			long endTime = thradBean.getCurrentThreadCpuTime();</span>
<span class="fc" id="L275">			out.println(&quot;Verification result: &quot; + result.toString());</span>
<span class="fc" id="L276">			out.println(&quot;Verification time: &quot;</span>
<span class="fc" id="L277">					+ Long.toString(TimeUnit.MILLISECONDS.convert(</span>
							(endTime - startTime), TimeUnit.NANOSECONDS))
					+ &quot; ms&quot;);
<span class="fc" id="L280">			out.println(&quot;Dimension of the intersection automaton (states+transitions): &quot;</span>
<span class="fc" id="L281">					+ this.checker.getIntersectionAutomataSize());</span>
<span class="pc bpc" id="L282" title="1 of 2 branches missed.">			if (result.equals(SatisfactionValue.NOTSATISFIED)) {</span>
<span class="nc" id="L283">				out.println(&quot;Counterexample:&quot;</span>
<span class="nc" id="L284">						+ this.checker.getFilteredCounterexample());</span>
			}

<span class="nc" id="L287">		} catch (CHIAException e) {</span>
<span class="nc" id="L288">			LOGGER.info(e.toString());</span>
<span class="fc" id="L289">		}</span>
<span class="fc" id="L290">	}</span>

	public void computeConstraint() throws FileNotFoundException,
			ParserConfigurationException, SAXException, IOException {
		try {
<span class="fc" id="L295">			this.chiaState = chiaState.perform(ConstraintGenerator.class);</span>
<span class="fc" id="L296">			cg = new ConstraintGenerator(this.checker);</span>
<span class="fc" id="L297">			this.constraint = cg.perform();</span>

<span class="fc" id="L299">			LOGGER.info(&quot;Constraint computed&quot;);</span>
			// this.constraint = this.chia.generateConstraint();
<span class="nc" id="L301">		} catch (CHIAException e) {</span>
<span class="nc" id="L302">			LOGGER.info(e.toString());</span>
<span class="fc" id="L303">		}</span>

<span class="fc" id="L305">	}</span>

	public void saveConstraint(String constraintFilePath) throws Exception {
		try {
<span class="nc" id="L309">			this.chiaState = chiaState.perform(ConstraintWriter.class);</span>

<span class="nc" id="L311">			ConstraintWriter constraintWriter = new ConstraintWriter(</span>
					this.constraint, constraintFilePath);
<span class="nc" id="L313">			constraintWriter.perform();</span>
<span class="nc" id="L314">			LOGGER.info(&quot;Constraint saved&quot;);</span>
<span class="nc" id="L315">		} catch (CHIAException e) {</span>
<span class="nc" id="L316">			LOGGER.info(e.toString());</span>
<span class="nc" id="L317">		}</span>
<span class="nc" id="L318">	}</span>

	public void dispConstraint() throws ParserConfigurationException, Exception {
		try {
<span class="fc" id="L322">			this.chiaState = chiaState</span>
<span class="fc" id="L323">					.perform(ConstraintToStringTrasformer.class);</span>
<span class="fc" id="L324">			ConstraintToStringTrasformer action = new ConstraintToStringTrasformer(</span>
					this.constraint);
<span class="fc" id="L326">			LOGGER.info(action.perform());</span>
<span class="nc" id="L327">		} catch (CHIAException e) {</span>
<span class="nc" id="L328">			LOGGER.info(e.toString());</span>
<span class="fc" id="L329">		}</span>
<span class="fc" id="L330">	}</span>

	public void exit() {
<span class="fc" id="L333">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span></div></body></html>