<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Injector.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">CHIAConstraint</a> &gt; <a href="index.source.html" class="el_package">it.polimi.constraints.utils</a> &gt; <span class="el_source">Injector.java</span></div><h1>Injector.java</h1><pre class="source lang-java linenums">/**
 * 
 */
package it.polimi.constraints.utils;

import rwth.i2.ltl2ba4j.model.IGraphProposition;
import it.polimi.action.CHIAAction;
import it.polimi.automata.IBA;
import it.polimi.automata.state.State;
import it.polimi.automata.transition.Transition;
import it.polimi.constraints.components.Replacement;
import it.polimi.constraints.transitions.PluggingTransition;

import com.google.common.base.Preconditions;

/**
 * Inject the a replacement into an IBA
 * 
 * @author Claudio Menghi
 *
 */
public class Injector extends CHIAAction&lt;IBA&gt; {

	/**
	 * The incomplete Buchi automaton where the replacement must be injected
	 */
	private final IBA model;
	/**
	 * The replacement to be injected into the model
	 */
	private final Replacement replacement;

	/**
	 * The name of the CHIAAction
	 */
	private static final String ACTION_NAME = &quot;INJECTION&quot;;

	/**
	 * creates a new Injector. The injector injects the replacement into the IBA
	 * 
	 * @param model
	 *            the model where the replacement must be injected
	 * @param replacement
	 *            the replacement to be injected into the model
	 * @throws NullPointerException
	 *             if one of the parameters is null
	 * @throws IllegalArgumentException
	 *             if the replacement is not associated with a black box state
	 *             of the model
	 */
	public Injector(IBA model, Replacement replacement) {
<span class="fc" id="L52">		super(ACTION_NAME);</span>
<span class="fc" id="L53">		Preconditions.checkNotNull(model,</span>
				&quot;The model to be considered by the injector cannot be null&quot;);
<span class="fc" id="L55">		Preconditions.checkNotNull(replacement,</span>
				&quot;The replacement to be injected into the model cannot be null&quot;);
<span class="fc" id="L57">		Preconditions</span>
<span class="fc" id="L58">				.checkArgument(</span>
<span class="fc" id="L59">						model.getBlackBoxStates().contains(</span>
<span class="fc" id="L60">								replacement.getModelState()),</span>
						&quot;The replacement must be associated with a black box state of the model&quot;);
<span class="fc" id="L62">		State blackBoxState = replacement.getModelState();</span>

<span class="fc bfc" id="L64" title="All 2 branches covered.">		for (PluggingTransition incomingTransition : replacement</span>
<span class="fc" id="L65">				.getIncomingTransitions()) {</span>
<span class="fc bfc" id="L66" title="All 2 branches covered.">			if (!model.getPredecessors(blackBoxState).contains(</span>
<span class="fc" id="L67">					incomingTransition.getSource())) {</span>
<span class="fc" id="L68">				throw new IllegalArgumentException(</span>
						&quot;The source of an incoming transition to be injected was not connected to the black box state&quot;);
			}
<span class="fc" id="L71">		}</span>

<span class="fc bfc" id="L73" title="All 2 branches covered.">		for (PluggingTransition outgoingTransition : replacement</span>
<span class="fc" id="L74">				.getOutgoingTransitions()) {</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">			if (!model.getSuccessors(blackBoxState).contains(</span>
<span class="fc" id="L76">					outgoingTransition.getDestination())) {</span>
<span class="fc" id="L77">				throw new IllegalArgumentException(</span>
						&quot;the destination of an out-coming transition was not connected to the black box state&quot;);
			}
<span class="fc" id="L80">		}</span>

<span class="fc" id="L82">		this.model = model.clone();</span>
<span class="fc" id="L83">		this.replacement = replacement;</span>
<span class="fc" id="L84">	}</span>

	/**
	 * injects the replacement into the IBA
	 * 
	 * @return an IBA where the replacement has been injected into the IBA
	 * 
	 */
	@Override
	public IBA perform() throws Exception {
<span class="fc" id="L94">		IBA newIba = (IBA) this.model;</span>

<span class="fc" id="L96">		IBA ibaToInject = replacement.getAutomaton();</span>
<span class="fc" id="L97">		this.injectTheAutomaton(newIba, ibaToInject);</span>
<span class="fc" id="L98">		newIba.removeState(replacement.getModelState());</span>
<span class="fc" id="L99">		this.addIncomingTransitions(newIba);</span>
<span class="fc" id="L100">		this.addOutgoingTransitions(newIba);</span>
<span class="fc" id="L101">		return newIba;</span>
	}

	/**
	 * inject the incoming transitions of the replacement into the IBA
	 * 
	 * @param newIBA
	 *            is the IBA where the incoming transitions of the replacement
	 *            must be injected
	 * @throws NullPointerException
	 *             if the newIba is null
	 */
	protected void addIncomingTransitions(IBA newIBA) {
<span class="fc" id="L114">		Preconditions.checkNotNull(newIBA, &quot;The newIBA cannot be null&quot;);</span>
		// processing the incoming transitions
		// for each incoming transition
<span class="fc bfc" id="L117" title="All 2 branches covered.">		for (PluggingTransition pluggingTransition : replacement</span>
<span class="fc" id="L118">				.getIncomingTransitions()) {</span>
<span class="fc" id="L119">			newIBA.addTransition(pluggingTransition.getSource(),</span>
<span class="fc" id="L120">					pluggingTransition.getDestination(),</span>
<span class="fc" id="L121">					pluggingTransition.getTransition());</span>
<span class="fc" id="L122">		}</span>
<span class="fc" id="L123">	}</span>

	/**
	 * inject the outgoing transitions of the replacement into the IBA
	 * 
	 * @param newIBA
	 *            is the IBA where the incoming transitions of the replacement
	 *            must be injected
	 * @throws NullPointerException
	 *             if the newIba is null
	 */
	protected void addOutgoingTransitions(IBA newIBA) {
<span class="fc" id="L135">		Preconditions.checkNotNull(newIBA, &quot;The newIBA cannot be null&quot;);</span>
		// processing the out-coming transitions
<span class="fc bfc" id="L137" title="All 2 branches covered.">		for (PluggingTransition pluggingTransition : replacement</span>
<span class="fc" id="L138">				.getOutgoingTransitions()) {</span>
<span class="fc" id="L139">			newIBA.addTransition(pluggingTransition.getSource(),</span>
<span class="fc" id="L140">					pluggingTransition.getDestination(),</span>
<span class="fc" id="L141">					pluggingTransition.getTransition());</span>
<span class="fc" id="L142">		}</span>
<span class="fc" id="L143">	}</span>

	/**
	 * @param newIba
	 *            the IBA where the ibaToInject must be injected
	 * @param ibaToInject
	 *            is the IBA to be injected into the newIBA
	 * @throws NullPointerException
	 *             if one of the IBA is null
	 */
	protected void injectTheAutomaton(IBA newIba, IBA ibaToInject) {
<span class="fc" id="L154">		Preconditions</span>
<span class="fc" id="L155">				.checkNotNull(newIba,</span>
						&quot;The iba where the IBAToInject must be inserted cannot be null&quot;);
<span class="fc" id="L157">		Preconditions.checkNotNull(ibaToInject,</span>
				&quot;The iba to be injected cannot be null&quot;);

<span class="fc bfc" id="L160" title="All 2 branches covered.">		for (IGraphProposition proposition: ibaToInject.getPropositions()){</span>
<span class="fc" id="L161">			newIba.addProposition(proposition);</span>
<span class="fc" id="L162">		}</span>
<span class="fc bfc" id="L163" title="All 2 branches covered.">		for (State s : ibaToInject.getStates()) {</span>
<span class="fc" id="L164">			newIba.addState(s);</span>
<span class="fc" id="L165">		}</span>
<span class="fc bfc" id="L166" title="All 2 branches covered.">		for (State s : ibaToInject.getBlackBoxStates()) {</span>
<span class="fc" id="L167">			newIba.addBlackBoxState(s);</span>
<span class="fc" id="L168">		}</span>
<span class="fc bfc" id="L169" title="All 2 branches covered.">		for (State s : ibaToInject.getInitialStates()) {</span>
<span class="fc" id="L170">			newIba.addInitialState(s);</span>
<span class="fc" id="L171">		}</span>
<span class="fc bfc" id="L172" title="All 2 branches covered.">		for (State s : ibaToInject.getAcceptStates()) {</span>
<span class="fc" id="L173">			newIba.addAcceptState(s);</span>
<span class="fc" id="L174">		}</span>

		// copy the transition into the refinement
<span class="fc bfc" id="L177" title="All 2 branches covered.">		for (Transition t : ibaToInject.getTransitions()) {</span>
<span class="fc" id="L178">			newIba.addTransition(ibaToInject.getTransitionSource(t),</span>
<span class="fc" id="L179">					ibaToInject.getTransitionDestination(t), t);</span>
<span class="fc" id="L180">		}</span>
<span class="fc" id="L181">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span></div></body></html>